<!DOCTYPE html>
<html lang="fr" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formation — Power BI</title>
    <link rel="icon" href="assets/youtube_v2/logo.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="index.html" class="brand">
          <img src="assets/youtube_v2/logo.svg" alt="MM" />
          <span>Mustapha MANAD</span>
        </a>
        <nav>
          <a href="index.html#formations">Formations</a>
          <a href="index.html#about">À propos</a>
          <button
            class="theme-toggle"
            id="themeToggle"
            type="button"
            aria-label="Passer en mode sombre"
            aria-pressed="false">
            <svg
              class="icon icon-moon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false">
              <path
                d="M21 12.8A9 9 0 1 1 11.2 3a7 7 0 0 0 9.8 9.8z" />
            </svg>
            <svg
              class="icon icon-sun"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false">
              <circle cx="12" cy="12" r="4" fill="none" />
              <path
                d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
                fill="none" />
            </svg>
          </button>
          <a href="index.html#contact" class="btn-primary">Contact</a>
        </nav>
      </div>
    </header>

    <main id="main">
      <section class="project-hero">
        <div class="container">
          <div>
            <h1 id="title">Formation</h1>
            <p class="subtitle" id="subtitle">—</p>
            <div class="project-meta" id="meta"></div>
            <div class="actions">
              <a class="btn-outline" href="index.html#formations">← Retour aux formations</a>
              <a class="btn-primary" id="ctaEmbed" target="_blank" rel="noopener">Voir la démo Power BI</a>
            </div>
          </div>
          <div class="cover" id="cover"></div>
        </div>
      </section>

      <section class="project-body">
        <div class="container">
          <div>
            <div class="panel" id="description"></div>

            <h2>Supports & exercices</h2>
            <div class="gallery" id="gallery" aria-label="Aperçus de la formation">
              <div class="track" id="galleryTrack"></div>
            </div>
          </div>
          <div>
            <h2>Démo Power BI</h2>
            <div class="embed-wrapper" id="embed"></div>

            <div class="panel" style="margin-top:14px;">
              <h2>Objectifs pédagogiques</h2>
              <ul id="bullets" style="margin:8px 0 0 18px; color: var(--muted);"></ul>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <span>© <span id="year"></span> Mustapha MANAD</span>
        <span>Formations — Power BI & Data Analytics</span>
      </div>
    </footer>

    <script src="theme.js"></script>
    <script>
      const $ = (s, r = document) => r.querySelector(s);
      const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
      const params = new URLSearchParams(location.search);
      const id = params.get('id');

      function setYear(){ const yEl = document.getElementById('year'); if(yEl){ yEl.textContent = new Date().getFullYear(); } }

      async function loadProjects(){
        const res = await fetch('projects.json');
        return await res.json();
      }

      function notFound(){
        $('#main').innerHTML = '<section class="section"><div class="container"><h2>Formation introuvable</h2><p>Vérifiez le lien ou retournez aux <a href="index.html#formations">formations</a>.</p></div></section>';
      }

      function mountProject(p){
        $('#title').textContent = p.title;
        $('#subtitle').textContent = p.subtitle || '';
        // meta tags
        const meta = $('#meta');
        meta.innerHTML = '';
        (p.tags||[]).forEach(t=>{
          const el = document.createElement('span');
          el.className = 'badge';
          el.textContent = t;
          meta.appendChild(el);
        });
        // cover
        const cover = $('#cover');
        cover.innerHTML = `<img src="${p.cover}" alt="${p.title}" style="width:100%; height:100%; object-fit:cover;"/>`;
        // desc
        $('#description').innerHTML = `<h2>Programme</h2><p>${p.description || p.excerpt || ''}</p>`;

        // bullets
        const bullets = $('#bullets');
        bullets.innerHTML = (p.highlights||[]).map(x=>`<li>${x}</li>`).join('');

        // Gallery
        const track = $('#galleryTrack');
        if(p.images && p.images.length){
          const q = p.images.length;
          p.images.forEach((src, idx)=>{
            const slide = document.createElement('div');
            slide.className = 'slide';
            slide.style.setProperty('--q', q);
            slide.style.setProperty('--i', idx + 1);
            slide.innerHTML = `<img src="${src}" alt="${p.title} - ${idx+1}" loading="lazy">`;
            track.appendChild(slide);
          });
        } else {
          $('#gallery').style.display = 'none';
        }

        // Embed
        const tgt = $('#embed');
        const cta = $('#ctaEmbed');
        if(p.powerbi_embed_url){
          tgt.innerHTML = `<iframe title="${p.title}" src="${p.powerbi_embed_url}" allowfullscreen></iframe>`;
          cta.href = p.powerbi_embed_url;
        } else {
          tgt.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted);">Démo à venir</div>';
          cta.classList.add('btn-outline');
          cta.textContent = 'Démo à venir';
          cta.removeAttribute('href');
        }
      }

      (async function(){
        try{
          setYear();
          const projects = await loadProjects();
          const p = projects.find(x => x.id === id);
          if(!p) return notFound();
          mountProject(p);
        }catch(e){
          console.error(e);
          notFound();
        }
      })();
    </script>
  </body>
  </html>
